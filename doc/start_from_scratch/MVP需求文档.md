# 罡好饭 - 最小可用产品(MVP)需求文档

## 一、产品概述
一个极简的工作日餐饮预订系统，员工内部的提前订餐，管理员可以发布餐次和管理订单。

## 二、核心业务逻辑

### 2.1 基础概念
- **餐次(Meal)**: 某一天的午餐或晚餐
- **订单(Order)**: 用户对某个餐次的预订
- **余额(Balance)**: 用户账户中的余额

### 2.2 核心规则
1. 每个工作日有午餐和晚餐两个时段
2. 每人每餐次限订一份
3. 先扣款后订餐，余额主要目的用于对账，允许负余额。所以下单等操作不受余额限制。
4. 餐次锁定后不能修改订单

## 三、最小功能集

### Phase 1: 基础框架（第1-2天）
**目标**: 搭建可运行的前后端框架

#### 后端
- FastAPI项目结构
- 基础路由配置
- 健康检查接口 `/api/v1/health`
- CORS配置

#### 前端  
- 微信小程序项目初始化
- 基础页面结构（仅首页）
- API请求封装

#### 数据库
- DuckDB嵌入式数据库
- 基础表结构：users, meals, orders, 

### Phase 2: 用户认证（第3-4天）
**目标**: 实现用户登录和身份识别

#### 功能点
1. 微信登录接口（开发模式使用mock）
2. JWT Token生成和验证
3. 用户信息存储（openid、昵称）

#### 接口
- `POST /api/v1/auth/login` - 微信登录
- `GET /api/v1/auth/me` - 获取当前用户信息

### Phase 3: 餐次展示（第5-6天）
**目标**: 用户可以看到可订餐次

#### 功能点
1. 管理员发布餐次（硬编码管理员）
2. 日历视图展示餐次
3. 餐次状态显示（可订/已锁定）

#### 接口
- `POST /api/v1/meals` - 发布餐次（管理员）
- `GET /api/v1/meals` - 获取餐次列表

#### 界面
- 日历主页：显示一周的餐次
- 每天显示午餐、晚餐两个卡片
- 卡片显示：价格、状态

### Phase 4: 下单功能（第7-8天）
**目标**: 用户可以订餐

#### 功能点
1. 点击餐次弹出订餐对话框
2. 确认下单，扣除余额
3. 显示我的订单状态

#### 接口
- `POST /api/v1/orders` - 创建订单
- `GET /api/v1/orders/my` - 我的订单列表
- `DELETE /api/v1/orders/{id}` - 取消订单

#### 业务逻辑
- 检查余额是否充足
- 检查是否重复下单
- 扣款并生成订单

### Phase 5: 余额管理（第9-10天）
**目标**: 管理用户余额

#### 功能点
1. 显示当前余额
2. 管理员给用户充值
3. 查看余额变动记录

#### 接口
- `GET /api/v1/users/balance` - 查询余额
- `POST /api/v1/users/recharge` - 充值（管理员）
- `GET /api/v1/ledger` - 账单明细

## 四、界面需求

### 4.1 小程序端界面（极简版）

#### 首页 - 日历视图
```
[罡好饭]                    [余额: ¥50.00]
----------------------------------------
   一    二    三    四    五   
  11/25  11/26  11/27  11/28  11/29
  
  [午餐]  [午餐]  [午餐]  [午餐]  [午餐]
  ¥15    ¥15    已订    ¥15    ¥15
  
  [晚餐]  [晚餐]  [晚餐]  [晚餐]  [晚餐]
  ¥18    已锁    ¥18    ¥18    ¥18
```

#### 订餐弹窗
```
[订餐确认]
日期：11月26日 午餐
价格：¥15.00
数量：1份

[确认订餐]  [取消]
```

### 4.2 数据结构设计

#### users表
```sql
- id: 自增主键
- open_id: 微信用户标识
- nickname: 昵称
- balance_cents: 余额(分)
- is_admin: 是否管理员
```

#### meals表
```sql
- meal_id: 自增主键
- date: 日期
- slot: 时段(lunch/dinner)
- price_cents: 价格(分)
- status: 状态(published/locked)
```

#### orders表
```sql
- order_id: 自增主键
- user_id: 用户ID
- meal_id: 餐次ID
- amount_cents: 金额(分)
- status: 状态(active/canceled)
```

## 五、渐进实现路径

### 第一阶段：MVP核心（2周）
1. **Week 1**: Phase 1-3（框架+认证+展示）
2. **Week 2**: Phase 4-5（下单+余额）

### 第二阶段：功能增强（1周）
1. 餐次锁定/完成流程
2. 订单修改功能
3. 批量操作界面

### 第三阶段：体验优化（1周）
1. 配菜选项
2. 统计报表
3. 深色模式
4. 性能优化

## 六、技术选型

### 后端
- **框架**: FastAPI（Python 3.11+）
- **数据库**: DuckDB（嵌入式，零配置）
- **认证**: JWT Token

### 前端
- **框架**: 微信小程序原生
- **语言**: TypeScript
- **状态管理**: 小程序全局状态

### 部署
- **后端**: 单机Python进程
- **数据**: 本地文件存储
- **访问**: HTTP服务（开发环境）

## 七、开发优先级

### Must Have (MVP必须)
1. 用户登录
2. 查看餐次
3. 下单订餐
4. 余额扣款

### Should Have (应该有)
1. 取消订单
2. 管理员发布餐次
3. 余额充值
4. 订单列表

### Nice to Have (最好有)
1. 配菜选项
2. 统计导出
3. 深色模式
4. 批量操作

## 八、成功标准

MVP成功的标志：
1. 用户能够登录系统
2. 用户能够看到本周餐次
3. 用户能够成功订餐
4. 系统能够正确扣款
5. 管理员能够发布餐次

## 九、风险与限制

1. **技术风险**: 微信登录需要企业认证（开发期使用Mock）
2. **业务风险**: 余额系统需要财务对账（MVP简化处理）
3. **性能限制**: 单机部署，并发能力有限（MVP够用）

## 十、下一步行动

### 立即开始（Day 1）
设计项目目录结构
1. 创建项目目录结构
2. 初始化FastAPI项目
3. 创建数据库表
4. 实现健康检查接口
5. 初始化小程序项目
6. 测试前后端连通性

### 快速迭代原则
- 每个功能点不超过2天
- 优先实现核心路径
- 延后所有美化工作
- 保持代码简单直接
- 及时测试每个环节